<!DOCTYPE html>
<html>
<head>
<title>Video Generator</title>
</head>

<body style="text-align:center;font-family:sans-serif">

<h2>ğŸ¬ ØªÙˆÙ„ÙŠØ¯ ÙÙŠØ¯ÙŠÙˆ</h2>

<form id="form">

<input name="prompt" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª" required>
<br><br>

<input name="filename" placeholder="Ø§Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ" required>
<br><br>

<button type="submit">ØªÙˆÙ„ÙŠØ¯</button>

</form>

<br>

<div id="progress"></div>

<br>

<video id="video" width="500" controls style="display:none"></video>

<br>
<a id="download" style="display:none">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</a>

<script>

document.getElementById("form").onsubmit = async (e) => {

    e.preventDefault()

    let formData = new FormData(e.target)

    let res = await fetch("/generate", {
        method: "POST",
        body: formData
    })

    let data = await res.json()
    checkProgress(data.job_id)
}

async function checkProgress(job_id){

    let interval = setInterval(async () => {

        let res = await fetch("/progress/" + job_id)
        let data = await res.json()

        document.getElementById("progress").innerText =
            "Progress: " + data.progress + "%"

        if(data.progress === 100){

            clearInterval(interval)

            let videoUrl = "/video/" + data.video

            let video = document.getElementById("video")
            video.src = videoUrl
            video.style.display = "block"

            let dl = document.getElementById("download")
            dl.href = videoUrl
            dl.innerText = "ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"
            dl.style.display = "block"
        }

    }, 1000)
}

</script>

</body>
</html>
