<!DOCTYPE html>
<html>
<head>
<title>Video Generator</title>
</head>
<body style="text-align:center;font-family:sans-serif">

<h2>ğŸ¬ ØªÙˆÙ„ÙŠØ¯ ÙÙŠØ¯ÙŠÙˆ Ø¹Ø¨Ø± fal.ai</h2>

<form id="form">
<input name="prompt" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª" required><br><br>
<input name="filename" placeholder="Ø§Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ" required><br><br>
<button type="submit">ØªÙˆÙ„ÙŠØ¯</button>
</form>

<br>
<div style="width:500px;margin:auto;background:#eee;height:25px;border-radius:5px;">
    <div id="progress-bar" style="width:0%;height:25px;background:#4caf50;border-radius:5px;text-align:center;color:white;">
        0%
    </div>
</div>
<div id="stage" style="margin-top:10px;font-weight:bold;"></div>

<br>
<video id="video" width="500" controls style="display:none"></video>
<br>
<a id="download" style="display:none">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</a>

<script>
document.getElementById("form").onsubmit = async (e) => {
    e.preventDefault()
    let formData = new FormData(e.target)
    let res = await fetch("/generate", { method:"POST", body: formData })
    let data = await res.json()
    checkProgress(data.job_id)
}

async function checkProgress(job_id){
    let interval = setInterval(async () => {
        let res = await fetch("/progress/" + job_id)
        let data = await res.json()

        let bar = document.getElementById("progress-bar")
        bar.style.width = data.progress + "%"
        bar.innerText = data.progress + "%"

        document.getElementById("stage").innerText = data.stage || ""

        if(data.progress === 100){
            clearInterval(interval)
            let videoUrl = "/video/" + data.video
            let video = document.getElementById("video")
            video.src = videoUrl
            video.style.display = "block"

            let dl = document.getElementById("download")
            dl.href = videoUrl
            dl.innerText = "ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"
            dl.style.display = "block"
        }

        if(data.progress === -1){
            clearInterval(interval)
            document.getElementById("stage").innerText = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙˆÙ„ÙŠØ¯: " + data.stage
        }
    }, 1000)
}
</script>
</body>
</html>
